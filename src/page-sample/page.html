<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <script src="page.js"> </script>
  </head>
<body>
    <button type="button" id="authBtn" onclick="auth();return false">Auth</button>
    <div id="extensionPoking" style="display: block; background-color: yellow;">
        <h1>Please active the UniverseAI Data Wallet browser extension by clicking on the icon in your browser.</h1>
    </div>
    <script>
        let page;

        async function main() {
            console.log("page running");

            const postMessage = (message) => {
                window.postMessage({message, direction: "from-page-script"}, "*");
            };

            const listenMessage = (listener) => {
                window.addEventListener("message", (event) => {
                    if (event.source === window && event?.data?.direction === "from-content-script") {
                        listener(event.data.message);
                    }
                });
            };

            page = new module.Page(postMessage, listenMessage);

            page.rpc.onCall("init", () => {
                console.log("DataWallet activated");
                document.getElementById("authBtn").disabled = false;
                document.getElementById("extensionPoking").style.display = "none";
            });
        }


        document.getElementById("authBtn").disabled = true;
        document.getElementById("extensionPoking").style.display = "block";

        main();

        async function auth(e) {
            const response = await page.auth();

            console.log("auth response", response);

            page.connect(response[1]);
        }
    </script>
</body>
</html>
